generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
// BETTER-AUTH MODELS
// Généré automatiquement par better-auth
// ============================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified Boolean   @default(false)
  name          String?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  sessions      Session[]
  accounts      Account[]

  // Admin role
  role          String    @default("user")

  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Account {
  id                String   @id @default(cuid())
  userId            String
  accountId         String
  providerId        String
  accessToken       String?
  refreshToken      String?
  idToken           String?
  expiresAt         DateTime?
  password          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@map("accounts")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verifications")
}

// ============================================
// APPLICATION MODELS
// ============================================

model Article {
  id          Int      @id @default(autoincrement())
  titre       String
  categorie   String   // "ÉVÉNEMENTS", "ÉQUIPES", "FORMATION", "RECRUTEMENT", "CLUB"
  date        DateTime
  image       String
  resume      String   @db.Text
  contenu     String   @db.Text
  vedette     Boolean  @default(false)
  tag         String?
  tags        String[]
  slug        String   @unique
  published   Boolean  @default(true)
  views       Int      @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?

  @@index([categorie])
  @@index([vedette])
  @@index([published])
  @@index([date(sort: Desc)])
  @@map("articles")
}

model Equipe {
  id            Int            @id @default(autoincrement())
  nom           String
  categorie     String         // "N2F", "N2M", "Prénationale", "Elite", etc.
  genre         String         @default("MASCULIN") // "MASCULIN" ou "FEMININ"
  description   String         @db.Text
  entraineur    String
  matches       String?
  photo         String
  banniere      String?        // Image de fond pour la page équipe
  ordre         Int
  slug          String         @unique
  published     Boolean        @default(true)
  featured      Boolean        @default(false) // Afficher sur la page d'accueil

  entrainements Entrainement[]
  matchs        Match[]
  syncLogs      SyncLog[]
  classement    Classement[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  createdBy     String?

  @@index([categorie])
  @@index([published])
  @@index([ordre])
  @@index([featured])
  @@index([genre])
  @@map("equipes")
}

model Entrainement {
  id        Int     @id @default(autoincrement())
  jour      String  // "Lundi", "Mardi", etc.
  horaire   String  // "18h00 - 20h00"
  lieu      String? // Optionnel
  equipeId  Int

  equipe    Equipe  @relation(fields: [equipeId], references: [id], onDelete: Cascade)

  @@index([equipeId])
  @@map("entrainements")
}

model Partenaire {
  id                Int      @id @default(autoincrement())
  nom               String
  slug              String?  @unique // Nullable pour migration, sera rempli automatiquement
  categorie         String   // "Équipementier", "Institution", "Banque", etc.
  typePartenariat   String   @default("Partenaire") // "Équipementier", "Principal", "Institutionnel", "Technique", "Média"
  logo              String
  description       String   @db.Text
  site              String?
  email             String?
  telephone         String?

  // Réseaux sociaux (JSON: {facebook, instagram, linkedin, twitter, youtube})
  reseauxSociaux    Json?

  // Informations complémentaires
  anneeDemarrage    Int?     // Année du début du partenariat
  valeurs           String[] // Tags: "Innovation", "Local", "Jeunesse", etc.
  galerie           String[] // URLs des photos de la galerie

  // Storytelling & Branding
  accroche          String?  // Phrase d'accroche pour le hero
  couleurPrincipale String?  // Couleur de marque en hex (#FF5733)
  photoCouverture   String?  // Image de fond pour le hero
  apports           String[] // Ce qu'ils apportent au club (ex: "Équipement des coachs")
  temoignage        Json?    // {citation: string, auteur: string, role: string, photo?: string}
  projetsCommuns    String[] // Projets en collaboration avec le club

  partenaire_majeur Boolean  @default(false)
  ordre             Int      @default(0)
  published         Boolean  @default(true)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String?

  @@index([slug])
  @@index([partenaire_majeur])
  @@index([published])
  @@index([ordre])
  @@index([typePartenariat])
  @@map("partenaires")
}

model ContactMessage {
  id            Int      @id @default(autoincrement())
  nom           String
  prenom        String
  email         String
  telephone     String?
  message       String   @db.Text

  // Champs handball (optionnels)
  experience    Boolean  @default(false)
  niveau        String?
  positions     String[]

  read          Boolean  @default(false)
  archived      Boolean  @default(false)

  createdAt     DateTime @default(now())

  @@index([read])
  @@index([createdAt(sort: Desc)])
  @@map("contact_messages")
}

model Setting {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String   @db.Text
  type        String   // "string", "image", "boolean", "json"
  description String?  @db.Text

  updatedAt   DateTime @updatedAt
  updatedBy   String?

  @@index([key])
  @@map("settings")
}

model Match {
  id          Int      @id @default(autoincrement())
  equipeId    Int
  adversaire  String   // Nom de l'équipe adverse
  date        DateTime // Date et heure du match
  lieu        String   // Lieu du match
  domicile    Boolean  @default(true) // true = domicile, false = extérieur
  competition String?  // Type de compétition (championnat, coupe, etc.)

  // Scores (null si match à venir)
  scoreEquipe     Int?
  scoreAdversaire Int?

  // Logo de l'équipe adverse (URL depuis FFHANDBALL)
  logoAdversaire  String?

  // Statut
  termine     Boolean  @default(false) // Match joué ou à venir
  published   Boolean  @default(true)

  // Relations
  equipe      Equipe   @relation(fields: [equipeId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?

  @@index([equipeId])
  @@index([date(sort: Desc)])
  @@index([termine])
  @@index([published])
  @@map("matchs")
}

model SyncLog {
  id              Int      @id @default(autoincrement())
  equipeId        Int
  type            String   // "matches", "classement", etc.
  status          String   // "success", "error", "warning"
  message         String   @db.Text

  // Statistiques de synchronisation
  matchesCreated  Int      @default(0)
  matchesUpdated  Int      @default(0)
  matchesSkipped  Int      @default(0)

  // Relations
  equipe          Equipe   @relation(fields: [equipeId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())

  @@index([equipeId])
  @@index([createdAt(sort: Desc)])
  @@index([status])
  @@map("sync_logs")
}

model Classement {
  id        Int      @id @default(autoincrement())
  equipeId  Int
  position  Int
  club      String
  points    Int

  // Relations
  equipe    Equipe   @relation(fields: [equipeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([equipeId])
  @@map("classements")
}
